import gdxpds
import pandas as pd

# ---------- 1. 读取 GDX ----------
df = pd.read_csv('Area_raw.csv')

# ---------- 2. 解析国家代码（取前三位） ----------
df["country3"] = df["region"].str[:3]

# ---------- 3. Mapping ----------
mapping = {
    'GRL_AOIS': 'XLM', 'CAN_NWTT': 'CAN', 'RUS_SNCO': 'CIS', 'NOR_SNCC': 'XER', 'RUS_SWCO': 'CIS', 'RUS_LENA': 'CIS', 'RUS_YENS': 'XSE', 'USA_PACA': 'USA', 'FIN_SNCC': 'XE25', 'CAN_PACA': 'CAN', 'NOR_SWED': 'XE25', 'SWE_SWED': 'XE25', 'FIN_SWED': 'XE25', 'CAN_MACK': 'CAN', 'FIN_FINL': 'XE25', 'RUS_VOLG': 'CIS', 'RUS_OBBB': 'XSE', 'ISL_ICEL': 'XER', 'RUS_PACA': 'CIS', 'CAN_HBCO': 'CAN', 'FRO_SCTD': 'XER', 
    'GBR_SCTD': 'XE25', 'CAN_AOSB': 'CAN', 'EST_BSCC': 'XE25', 'EST_NARV': 'XE25', 'LVA_BSCC': 'XE25', 'DNK_DGCO': 'XE25', 'LVA_DAUG': 'XE25', 'CAN_SNEL': 'CAN', 'LTU_BSCC': 'XE25', 'LTU_NEMA': 'XE25', 'BLR_DAUG': 'CIS', 'GBR_EAWC': 'XE25', 'RUS_AMUR': 'XSE', 'IRL_IREL': 'XE25', 'GBR_IREL': 'XE25', 'BLR_NEMA': 'CIS', 'BLR_DNIP': 'CIS', 'KAZ_OBBB': 'CIS', 'DEU_DGCO': 'XE25', 'POL_PLCO': 'XE25', 'POL_ODER': 'XE25', 'POL_WISL': 'XE25', 'NLD_RHIN': 'XE25', 'DEU_EWES': 'XE25', 'DEU_ELBE': 'XE25', 'CHN_AMUR': 'CHN', 'CAN_STLA': 'CAN', 'DEU_RHIN': 'XE25', 'UKR_DNIP': 'CIS', 'MNG_YENS': 'XSE', 'NLD_SCHE': 'XE25', 'NLD_MAAS': 'XE25', 'UKR_DNIE': 'CIS', 
    'KAZ_CSPC': 'CIS', 'KAZ_SYRD': 'CIS', 'FRA_FWCX': 'XE25', 'BEL_SCHE': 'XE25', 'BEL_MAAS': 'XE25', 'CZE_ELBE': 'XE25', 'CZE_ODER': 'XE25', 'MNG_GOBI': 'XSE', 'FRA_SEIN': 'XE25', 'LUX_RHIN': 'XE25', 'DEU_DANU': 'XE25', 'CZE_DANU': 'XE25', 'UKR_DONN': 'CIS', 'MNG_AMUR': 'XSE', 'SVK_DANU': 'XE25', 'UKR_BSNC': 'CIS', 'USA_MSMM': 'USA', 'FRA_RHON': 'XE25', 'AUT_DANU': 'XE25', 'UKR_DANU': 'XER', 'KAZ_LKBH': 'CIS', 'CHN_GOBI': 'CHN', 'USA_COLU': 'XLM', 'FRA_LOIR': 'XE25', 'HUN_DANU': 'XE25', 'ROU_DANU': 'XER', 'MDA_DANU': 'CIS', 'MDA_DNIE': 'CIS', 'CHE_RHIN': 'XE25', 'USA_GMAN': 'USA', 'CHE_RHON': 'XE25', 'LIE_RHIN': 'XE25', 'ITA_IECO': 'XE25', 'MDA_BSNC': 'CIS', 'CHE_POOO': 'XE25', 'ITA_POOO': 'XE25', 'SVN_DANU': 'XE25', 'HRV_DANU': 'XER', 'SVN_AGBS': 'XE25', 'SRB_DANU': 'XER', 'KAZ_CSEC': 'CIS', 'FRA_GIRD': 'XE25', 'HRV_AGBS': 'XER', 'UZB_CSEC': 'CIS', 'UZB_AMDA': 'XSA', 'JPN_JAPN': 'JPN', 'BIH_DANU': 'XER', 'CHN_TARI': 'CHN', 'ITA_IWCO': 'XE25', 'BIH_AGBS': 'XER', 'BGR_DANU': 'XER', 'ESP_SPAC': 'XE25', 'MCO_FSCD': 'XE25', 'ITA_TIBE': 'XE25', 
    'SMR_IECO': 'XE25', 'MNE_DANU': 'XER', 'BGR_AGBS': 'XE25', 'GEO_BSSC': 'CIS', 'USA_NACC': 'XLM', 'ESP_DOUR': 'XE25', 'ESP_EBRO': 'XE25', 'MNE_AGBS': 'XER', 'XKX_DANU': 'XER', 'GEO_CSSW': 'CIS', 'KGZ_SYRD': 'CIS', 'PRK_RSEC': 'XSE', 'AND_EBRO': 'XE25', 'ALB_AGBS': 'XE25', 'XKX_AGBS': 'XER', 'TKM_AMDA': 'XSA', 'TKM_CSEC': 'XSA', 'KGZ_LKBH': 'CIS', 'CHN_HHEE': 'CHN', 'PRT_SPAC': 'XE25', 'ESP_SSEC': 'XE25', 'MKD_AGBS': 'XE25', 'TUR_BSSC': 'TUR', 'UZB_SYRD': 'CIS', 'KGZ_TARI': 'CIS', 'PRK_AMUR': 'XSE', 'PRK_NSKU': 'XSE', 'PRT_DOUR': 'XE25', 'GRC_AGBS': 'XE25', 'TUR_CSSW': 'XME', 'AZE_CSSW': 'CIS', 'PRK_BHKN': 'XSE', 'ESP_TAGU': 'XE25', 'ITA_MSII': 'XE25', 'ARM_CSSW': 'CIS', 'TJK_SYRD': 'CIS', 'PRT_TAGU': 'XE25', 'ESP_GUAD': 'XE25', 'TUR_MSEC': 'XME', 'TUR_TIEU': 'XME', 'IRN_CSSW': 'XME', 'TJK_AMDA': 'XSA', 'PRT_GUAD': 'XE25', 'ESP_GUDA': 'XE25', 'KOR_NSKU': 'XSE', 'USA_GFCO': 'XLM', 'IRN_TIEU': 'XME', 'IRN_CSEC': 'XSA', 'AFG_AMDA': 'XSA', 'CHN_CHIN': 'CHN', 'DZA_MSCC': 'XNF', 'TUN_MSCC': 'XNF', 'SYR_TIEU': 'XME', 'IRQ_TIEU': 'XME', 'IRN_CIRA': 'XSA', 'PAK_INDU': 'XSA', 'SYR_EJSS': 'XME', 'SYR_MSEC': 'XME', 'AFG_INDU': 'XSA', 'DZA_ANIN': 'XNF', 'MLT_MSII': 'XE25', 'AFG_CSEC': 'XSA', 'MAR_ANWC': 'XNF', 'MAR_MSCC': 'XNF', 'CHN_YANG': 'CHN', 'TUN_ANIN': 'XNF', 'CYP_MSEC': 'XE25', 'IND_INDU': 'IND', 'LBN_MSEC': 'XME', 'AFG_HELM': 'XSA', 'AFG_FARA': 'XSA', 'MAR_ANIN': 'XNF', 'LBN_DEAS': 'XME', 'LBY_MSCC': 'XNF', 'ISR_DEAS': 'XME', 'ISR_MSEC': 'XME', 'SYR_DEAS': 'XME', 'JOR_EJSS': 'XME', 'MEX_BJCA': 'XLM', 'MEX_MNCW': 'XLM', 'LBY_ANIN': 'XNF', 'PSE_MSEC': 'XME', 'JOR_DEAS': 'XME', 'PSE_DEAS': 'XME', 'SAU_ARPA': 'XME', 'SAU_RSEE': 'XME', 'MEX_RGBV': 'XLM', 'EGY_ANIN': 'XNF', 'EGY_NILE': 'XNF', 'IRN_PGCO': 'XSA', 'EGY_ARGA': 'XNF', 'IND_GABR': 'IND', 'PAK_HAMU': 'XSA', 'IND_SABA': 'IND', 'JOR_SIPE': 'XME', 'KWT_ARPA': 'XME', 'KWT_TIEU': 'XME', 'NPL_GABR': 'XSA', 'PAK_SABA': 'XSA', 'MEX_MCIN': 'XLM', 'PAK_ASAC': 'XSA', 'MMR_IRRA': 'XSE', 'BTN_GABR': 'XSA', 'MMR_SALW': 'XSE', 'MRT_ANIN': 'XAF', 'BHS_CARI': 'XLM', 'BGD_GABR': 'XSA', 'BHR_ARPA': 'XME', 'QAT_ARPA': 'XME', 'ARE_ARPA': 'XME', 'OMN_ARPA': 'XME', 'MEX_RIVE': 'XLM', 'MRT_ANWC': 'XAF', 'DZA_NIGE': 'XNF', 'MLI_ANIN': 'XAF', 'NER_LCHA': 'XAF', 'IND_GODA': 'IND', 'BGD_BBCN': 'XSE', 'MMR_BBCN': 'XSE', 'MEX_RLER': 'XLM', 'CUB_CARI': 'XLM', 'TCD_ANIN': 'XAF', 'TCD_LCHA': 'XAF', 'VNM_HRIV': 'XSE', 'HKG_CHIN': 'CHN', 'SDN_NILE': 'XAF', 'LAO_MEKO': 'XSE', 'VNM_MEKO': 'XSE', 'MAC_XJIA': 'CHN', 'MEX_RIBA': 'XLM', 'MEX_YUPA': 'XLM', 'TCA_CARI': 'XLM', 'NER_NIGE': 'XAF', 'SDN_ANIN': 'XAF', 'SDN_ARGA': 'XAF', 'VNM_VNCO': 'XSE', 'IND_KRIS': 'IND', 'MMR_SITT': 'XSE', 'LAO_VNCO': 'XSE', 'PHL_PHIL': 'XSE', 'HTI_CARI': 'XLM', 'MLI_NIGE': 'XAF', 'THA_CHAO': 'XSE', 'THA_MEKO': 'XSE', 'CYM_CARI': 'XLM', 'DOM_CARI': 'XLM', 'MRT_SENE': 'XAF', 'SDN_LCHA': 'XAF', 'JAM_CARI': 'XLM', 'PRI_CARI': 'XLM', 'VGB_CARI': 'XLM', 'YEM_ARPA': 'XME', 'MNP_NMIG': 'XSA', 'BLZ_YUPA': 'XLM', 'VIR_CARI': 'XLM', 'GTM_GRIJ': 'XLM', 'GTM_YUPA': 'XLM', 'ATG_CARI': 'XLM', 'ERI_ARGA': 'XAF', 'YEM_RSEE': 'XME', 'KNA_CARI': 'XLM', 
    'MMR_PMAL': 'XSE', 'HND_SCAM': 'XLM', 'SEN_SENE': 'XAF', 'ERI_NILE': 'XAF', 'THA_PMAL': 'XSE', 'DMA_CARI': 'XLM', 'SEN_AFWC': 'XAF', 'MLI_SENE': 'XAF', 'GTM_SCAM': 'XLM', 'NIC_SCAM': 'XLM', 'BFA_NIGE': 'XAF', 'ETH_NILE': 'XAF', 'ERI_RIFT': 'XAF', 'ETH_RIFT': 'XAF', 'THA_GTCC': 'XSE', 'KHM_MEKO': 'XSE', 'SLV_SCAM': 'XLM', 'LCA_CARC': 'XLM', 'BFA_VOLT': 'XAF', 'GMB_AFWC': 'XAF', 'NGA_NIGE': 'XAF', 'NGA_LCHA': 'XAF', 'GUM_NMIG': 'XSA', 'VCT_CARC': 'XLM', 'BRB_CARC': 'XLM', 'CMR_LCHA': 'XAF', 'ABW_CARC': 'XLM', 'GRD_CARC': 'XLM', 'GNB_AFWC': 'XAF', 'GIN_AFWC': 'XAF', 'ETH_ARGA': 'XAF', 'DJI_ARGA': 'XAF', 'YEM_ARGA': 'XME', 'KHM_GTCC': 'XSE', 'COL_CARC': 'XLM', 'VEN_CARC': 'XLM', 'GIN_SENE': 'XAF', 'BEN_NIGE': 'XAF', 'SSD_NILE': 'XAF', 'GIN_NIGE': 'XAF', 'BEN_VOLT': 'XAF', 'DJI_RIFT': 'XAF', 'SOM_ARGA': 'XAF', 'CRI_SCAM': 'XLM', 'COL_MAGD': 'XLM', 'TTO_CARC': 'XLM', 'BFA_AFWC': 'XAF', 'GHA_VOLT': 'XAF', 'TGO_VOLT': 'XAF', 'VEN_MAGD': 'XLM', 'CIV_NIGE': 'XAF', 'CMR_NIGE': 'XAF', 'CAF_LCHA': 'XAF', 'VEN_ORIN': 'XLM', 'CIV_AFWC': 'XAF', 'BEN_AFWC': 'XAF', 'SOM_RIFT': 'XAF', 'PAN_SCAM': 'XLM', 'PAN_CEPC': 'XLM', 'SLE_AFWC': 'XAF', 'ETH_SHJU': 'XAF', 'LKA_SRIL': 'XSA', 'FSM_MICO': 'XSA', 'TGO_AFWC': 'XAF', 'NGA_AFWC': 'XAF', 'CAF_CONG': 'XAF', 'COL_CEPC': 'XLM', 'VEN_NESO': 'XLM', 'GUY_NESO': 'XLM', 'LBR_AFWC': 'XAF', 'SSD_CONG': 'XAF', 'GHA_AFWC': 'XAF', 'PLW_PAEI': 'XSA', 'COL_ORIN': 'XLM', 'NGA_GFGU': 'XAF', 'CMR_GFGU': 'XAF', 'MYS_NBCO': 'XSE', 'PHL_NBCO': 'XSE', 'MYS_PMAL': 'XSE', 'SUR_NESO': 'XLM', 'FRA_NESO': 'XE25', 'CMR_CONG': 'XAF', 'SSD_RIFT': 'XAF', 'IDN_SUMA': 'XSE', 'BRA_AMAZ': 'XLM', 'VEN_AMAZ': 'XLM', 'GUY_AMAZ': 'XLM', 'COD_CONG': 'XAF', 'SOM_SHJU': 'XAF', 'BRN_NBCO': 'XSE', 'KEN_RIFT': 'XAF', 'IDN_KALI': 'XSE', 'IDN_SULA': 'XSE', 'UGA_NILE': 'XAF', 'KEN_SHJU': 'XAF', 'GNQ_GFGU': 'XAF', 'COG_CONG': 'XAF', 'COL_AMAZ': 'XLM', 'GAB_GFGU': 'XAF', 'COG_GFGU': 'XAF', 'KEN_NILE': 'XAF', 'KIR_KINA': 'XSA', 'STP_GFGU': 'XAF', 'ECU_CEPC': 'XLM', 'SGP_PMAL': 'XSE', 'ECU_AMAZ': 'XLM', 'KEN_AECC': 'XAF', 'SOM_AECC': 'XAF', 'PER_AMAZ': 'XLM', 'IDN_IRJA': 'XSE', 'BRA_TOCA': 'BRA', 'TZA_NILE': 'XAF', 'RWA_NILE': 'XAF', 'PNG_PNGC': 'XSA', 'RWA_CONG': 'XAF', 'TZA_RIFT': 'XAF', 'BDI_NILE': 'XAF', 'TZA_AECC': 'XAF', 'BRA_SAOF': 'BRA', 'BDI_CONG': 'XAF', 'TZA_CONG': 'XAF', 'PNG_IRJA': 'XSA', 'PER_PERU': 'XLM', 'PNG_SEPI': 'XSA', 'AGO_CONG': 'XAF', 'IDN_JATI': 'XSE', 'PNG_FLYY': 'XSA', 'AGO_ANGC': 'XAF', 'SLB_SOLI': 'XSA', 'ZMB_CONG': 'XAF', 'TLS_JATI': 'XSE', 'TUV_TUVA': 'XSA', 'MWI_ZAMB': 'XAF', 'AUS_AUNC': 'XOC', 'BOL_AMAZ': 'XLM', 'BRA_UBSA': 'XLM', 'ZMB_ZAMB': 'XAF', 'MOZ_AECC': 'XAF', 'SLB_SPII': 'XSA', 'AGO_ZAMB': 'XAF', 'COM_MADA': 'XAF', 'MOZ_ZAMB': 'XAF', 'MDG_MADA': 'XAF', 'AGO_ASII': 'XAF', 'FJI_SPII': 'XSA', 'VUT_SPII': 'XSA', 'MWI_AECC': 'XAF', 'BRA_LAPL': 'XLM', 'BOL_LPUN': 'XLM', 'ZWE_ZAMB': 'XAF', 'BOL_LAPL': 'XLM', 'AUS_AINT': 'XOC', 'NAM_NAMC': 'XAF', 'AUS_AEAC': 'XOC', 'NAM_ASII': 'XAF', 'CHL_LPUN': 'XLM', 'CHL_NCHI': 'XLM', 'BWA_ORAN': 'XAF', 'BWA_ASII': 'XAF', 'MOZ_AIOC': 'XAF', 'ZWE_ASII': 'XAF', 'ZWE_AIOC': 'XAF', 'PRY_LAPL': 'XLM', 'ZWE_LIMP': 'XAF', 'AUS_AWEC': 'XOC', 'NCL_SPII': 'XSA', 'BWA_LIMP': 'XAF', 'ARG_LAPL': 'XLM', 'NAM_ORAN': 'XAF', 'MOZ_LIMP': 'XAF', 'ZAF_LIMP': 'XAF', 'ZAF_SASC': 'XAF', 'ZAF_ORAN': 'XAF', 'AUS_MRDA': 'XOC', 'ARG_SGRN': 'XLM', 'SWZ_SASC': 'XAF', 'ARG_SACC': 'XLM', 'AUS_ASCO': 'XOC', 'ZAF_SAWC': 'XAF', 'LSO_ORAN': 'XAF', 'URY_LAPL': 'XLM', 'URY_UBSA': 'XLM', 'ARG_PAMP': 'XLM', 'CHL_SCPA': 'XLM', 'ARG_NASA': 'XLM', 'ARG_SASS': 'XLM', 'NZL_NZLZ': 'XOC', 'ARG_NEGR': 'XLM', 'ZAF_ANTC': 'XAF', 'NOR_ANTC': 'XER', 'AUS_NZLZ': 'XOC'}

df["region_agg"] = df["country3"].map(mapping)

df_agg = df.groupby(
    ["year", "region_agg", "crop"], 
    as_index=False
)["value"].sum()

# ---------- 5. 最终整理成你想要的格式 ----------
df_result = df_agg[[ "region_agg", "year", "crop", "value"]].copy()

# ---------- 6. 保存 ----------
df_result.to_csv("Area_year_region_crop.csv", index=False)

print("完成！结果保存在 Area_year_region_crop.csv")
